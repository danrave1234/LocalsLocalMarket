spring.application.name=LocalsLocalMarket

# --- Profile ---
spring.profiles.active=${SPRING_PROFILES_ACTIVE:dev}

# --- Server ---
server.port=${PORT:8080}
# Bind to all interfaces for Cloud Run
server.address=0.0.0.0
# Respect proxy headers to avoid redirect loops behind load balancers/CDNs
server.forward-headers-strategy=framework
# Tomcat remote IP/Proto headers (commonly used by proxies)
server.tomcat.remoteip.remote-ip-header=x-forwarded-for
server.tomcat.remoteip.protocol-header=x-forwarded-proto
# Increase startup timeout for Cloud Run
server.tomcat.connection-timeout=20000
server.tomcat.keep-alive-timeout=20000
# Enable HTTP response compression
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain,text/css,application/javascript,text/javascript
server.compression.min-response-size=1024

# --- Database ---
spring.datasource.url=${LLM_DB_URL}
spring.datasource.driver-class-name=${LLM_DB_DRIVER}
spring.jpa.hibernate.ddl-auto=${LLM_JPA_DDL}
spring.datasource.username=${LLM_DB_USER}
spring.datasource.password=${LLM_DB_PASS}
spring.jpa.open-in-view=false
# HikariCP tuning (safe defaults)
spring.datasource.hikari.maximum-pool-size=${LLM_DB_POOL_MAX:10}
spring.datasource.hikari.minimum-idle=${LLM_DB_POOL_MIN_IDLE:2}
spring.datasource.hikari.idle-timeout=${LLM_DB_IDLE_TIMEOUT_MS:600000}
spring.datasource.hikari.connection-timeout=${LLM_DB_CONN_TIMEOUT_MS:30000}
spring.datasource.hikari.max-lifetime=${LLM_DB_MAX_LIFETIME_MS:1800000}
# Hibernate performance
spring.jpa.properties.hibernate.jdbc.batch_size=${LLM_HIBERNATE_BATCH_SIZE:25}
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.fetch_size=${LLM_HIBERNATE_FETCH_SIZE:50}
spring.jpa.properties.hibernate.default_batch_fetch_size=${LLM_HIBERNATE_DEFAULT_BATCH_FETCH_SIZE:50}

# --- Security ---
jwt.secret=${JWT_SECRET:your-secret-key-here-make-it-long-and-secure-in-production}
jwt.expiration=${JWT_EXPIRATION:86400000}

# --- File Upload Limits ---
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=20MB

# --- Logging ---
logging.level.org.springframework.security=${LLM_LOG_SECURITY:INFO}
logging.level.org.localslocalmarket.security=${LLM_LOG_SECURITY:INFO}
logging.level.AUDIT=${LLM_LOG_AUDIT:WARN}

# --- Error handling configuration ---
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=never
server.error.include-exception=false
server.error.include-path=always
server.error.include-timestamp=true

# --- Web resources ---
spring.web.resources.add-mappings=false

# --- Actuator (health check only) ---
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=when-authorized


# --- CORS configuration handled via CorsConfig bean ---
# (Disabled here to avoid conflicts and wildcard+credentials issues)
# spring.web.cors.allowed-origins=*
# spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
# spring.web.cors.allowed-headers=*
# spring.web.cors.allow-credentials=false
# spring.web.cors.max-age=3600

# --- Server configuration ---
# server.servlet.context-path=/api



# --- Security ---
llm.jwt.secret=${LLM_JWT_SECRET:change-this-secret-in-prod-please-32b-min}
llm.jwt.ttl-minutes=${LLM_JWT_TTL_MINUTES:1440}
llm.jwt.refresh-ttl-minutes=${LLM_JWT_REFRESH_TTL_MINUTES:10080}

# --- Rate Limiting (crawler-friendly) ---
llm.rate-limit.enabled=${LLM_RATE_LIMIT_ENABLED:true}
llm.rate-limit.window-minutes=${LLM_RATE_LIMIT_WINDOW_MINUTES:1}
llm.rate-limit.default-limit=${LLM_RATE_LIMIT_DEFAULT:300}
llm.rate-limit.auth-limit=${LLM_RATE_LIMIT_AUTH:10}
llm.rate-limit.upload-limit=${LLM_RATE_LIMIT_UPLOAD:20}
llm.rate-limit.create-limit=${LLM_RATE_LIMIT_CREATE:30}
llm.rate-limit.admin-limit=${LLM_RATE_LIMIT_ADMIN:200}

# --- Audit Logging ---
llm.audit.enabled=${LLM_AUDIT_ENABLED:true}
llm.audit.retention-hours=${LLM_AUDIT_RETENTION_HOURS:24}

# --- Input Validation ---
llm.validation.enabled=${LLM_VALIDATION_ENABLED:true}
llm.validation.max-email-length=${LLM_VALIDATION_MAX_EMAIL:255}
llm.validation.max-name-length=${LLM_VALIDATION_MAX_NAME:100}
llm.validation.max-description-length=${LLM_VALIDATION_MAX_DESCRIPTION:1000}
llm.validation.max-url-length=${LLM_VALIDATION_MAX_URL:500}
llm.validation.max-price=${LLM_VALIDATION_MAX_PRICE:999999.99}



# --- Uploads ---
llm.uploads.dir=${LLM_UPLOADS_DIR:uploads}
llm.uploads.image.format=${LLM_UPLOADS_IMAGE_FORMAT:webp}
llm.uploads.image.quality=${LLM_UPLOADS_IMAGE_QUALITY:0.95}
llm.uploads.webp.lossless=${LLM_UPLOADS_WEBP_LOSSLESS:false}

# --- Google Cloud Storage ---
llm.gcs.enabled=${LLM_GCS_ENABLED:true}
llm.gcs.bucket-name=${LLM_GCS_BUCKET_NAME:localslocalmarket.com}
llm.gcs.credentials-json=${LLM_GCS_CREDENTIALS_JSON:}

# --- File Upload Limits ---
llm.upload.max-file-size=10485760
llm.upload.allowed-image-types=jpg,jpeg,png,gif,webp
llm.upload.upload-directory=uploads
llm.upload.scan-for-viruses=true

# --- Caching ---
llm.cache.enabled=${LLM_CACHE_ENABLED:true}
llm.cache.ttl-seconds=${LLM_CACHE_TTL_SECONDS:900}
llm.cache.max-size=${LLM_CACHE_MAX_SIZE:2000}
# Category cache settings (categories change rarely, so longer TTL)
llm.cache.categories.ttl-seconds=${LLM_CACHE_CATEGORIES_TTL_SECONDS:1800}

# --- Email Configuration ---
spring.mail.host=smtp.zoho.com
spring.mail.port=587
spring.mail.username=${LLM_EMAIL_USERNAME}
spring.mail.password=${LLM_EMAIL_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.ssl.trust=smtp.zoho.com
spring.mail.default-encoding=UTF-8

# Email settings
llm.email.from=${LLM_EMAIL_FROM:no-reply@localslocalmarket.com}
llm.email.from-name=${LLM_EMAIL_FROM_NAME:LocalsLocalMarket}
llm.email.enabled=${LLM_EMAIL_ENABLED:true}

# SEO and Search Engine Notification
llm.seo.site.url=${LLM_SEO_SITE_URL:https://www.localslocalmarket.com}
llm.seo.google.ping.enabled=${LLM_SEO_GOOGLE_PING_ENABLED:true}
llm.seo.bing.ping.enabled=${LLM_SEO_BING_PING_ENABLED:true}

# --- OAuth / Google Sign-In ---
llm.google.client-id=${LLM_GOOGLE_CLIENT_ID}
